# OlivaDice For OlivOS 用户手册

*For Ver.3.4.0(1080)*

> *世界是属于每一个人的。要创造一个充满逻辑并尊重每一个人的世界。*    
> *——《[Новый Элемент Расселения](https://ru.wikipedia.org/wiki/%D0%9D%D0%BE%D0%B2%D1%8B%D0%B9_%D1%8D%D0%BB%D0%B5%D0%BC%D0%B5%D0%BD%D1%82_%D1%80%D0%B0%D1%81%D1%81%D0%B5%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F)》A.D.1960 Москва*


> 有关骰子的更多疑问欢迎前往[OlivOS论坛 - 青果铺](https://forum.olivos.run)提出

![DIXE(OLIVADICE)](/_static/DIXE_OLIVADICE.jpg)

## 前言
**“骰子机器人”**的本质，是一个通过或非官方（QQ）协议以及工具，或官方（Telegram、开黑啦等）开放平台接口，实现的一个部分或者全部由骰子机器人软件及其控制的普通用户账号或特殊账号的集合体，而“骰子”一词则，将该集合体的目标功能，限定为服务发生于这些场景的跑团中，提供模拟掷骰的功能以及其他与跑团相关的功能。  
所以，将跑团骰子机器人与娱乐机器人等同的观点是完全错误的，如果出现了这类混淆视听的观点，请确认他们所说的是不是**“骰娘”**这类意义更加丰富的词，而非**“骰子”**。  

## 基本状态

### 查看状态
`.bot` 骰子基本状态  

作为一个被某种程度上控制的账号，在软件的核心功能发挥作用时将会有如上指令可以响应。  
在通常情况下，这个指令所回复的内容将会包含这个骰子所运行的软件的相关信息。  

### 指令退群
`.bot exit` 退群  

由于在某些平台（例如QQ），骰子机器人的搭建方法基于非官方的灰色地带的方案，所以在这些平台，直接将骰子频繁踢出群是一种容易导致账号风控（间歇性甚至完全发不出消息）或封禁的事件，而主动退出则没有这种问题，所以骰子本身提供了相关指令，可以让骰子主动退群。  

### 指令开关
`.bot on` 启用指令  
`.bot off` 停用指令  

## 查询帮助
`.help` 查看默认帮助  
`.help [查询内容]` 查询对应的帮助内容  

本指令可以进行帮助文档的查询，当你查询的内容不能准确匹配帮助文档时，将会触发模糊搜索机制，骰子会主动为你推荐相似的候选内容，所以推荐多多进行尝试。  

## 掷骰
`.r [掷骰表达式] [理由]` 掷骰子  
`.rh [掷骰表达式] [理由]` 掷暗骰  
`.r[次数]#[掷骰表达式] [理由]` 多轮掷骰  
`.ww/w [掷骰表达式] [理由]` 掷无限骰  
`.ww/w[数字] [理由]` 掷无限骰  
`.dx/dxx [掷骰表达式] [理由]` 掷双重十字骰  
`.rx [掷骰表达式] [理由]` 不解析技能与武器名称的掷骰  

表达式支持[OneDice标准](https://github.com/OlivOS-Team/onedice)  

> 你可能会觉得指令很复杂，但其实，不只是现在的骰子如此  
> 这些表述方法最早甚至可追溯至上世纪70年代的美国DND跑团!  
> 你甚至可能在各种各样的规则书中见到以下的一种或几种描述方法!  
> 如果你很熟悉`塔系`、`赵系`、`溯洄(不是回)系`，特别是前两者，那么恭喜你，因为`OneDice`标准就是`青果系`与`赵系`和`塔系`三个骰系的开发者共同制定的！(同时`青果系`的开发者`仑质`也曾参与`溯洄系`的开发工作！)  
> 这意味着你会发现100%的内容都是一样的！  
> 不是80%也不是90%而是100%!  

### 常用示例
首先，比较符合直觉的是，用字母表示的骰子算符和加减乘除是一样的，它本质上是初等运算的扩展：

> .r  
> 骰子: [仑质]掷骰: 1D100=47  
>
> .r 100+3\*2  
> 骰子: [仑质]掷骰: 100+3\*2=100+3\*2=106  
>
> .r 2d100+3\*2  
> 骰子: [仑质]掷骰: 2d100+3\*2={82+22}(104)+3\*2=110  
>
> .r d50 洞穴入口  
> 骰子: [仑质]由于[洞穴入口]掷骰: d50=14  

#### 普通多面掷骰 d
```
AdB(kq)C(pb)DaE
```
先来看看`OneDice`怎么说：  
> 这是最基础的掷骰方式，即为掷`A`个面数为`B`的多面骰子，然后计算它们（全部或部分）的点数总和，即为该表达式的最终结果。  
> 当`a`存在时转变为骰池，等同`无限加骰池 a`的`Aa(B+1)kEmB`，即无加骰轮下计算不低于成功线的骰子个数。  

 符号 | 参数 | 名称 | 解释 | 缺省 | 类别
 :---: | :---: | :--- | :--- | :--- | :---
 d | A | 骰数 | 掷出多少个骰子 | 1 | 左值
 d | B | 面数 | 掷出的骰子有多少面 | - | 右值
 k/q | C | 选取线 | 只选取最大/小骰子</br>结果的个数，k大q小 | A | 参数
 p/b | D | 奖惩数 | 追加奖惩骰的个数 | 0 | 参数
 a | E | 骰池 | 功能转换为骰池</br>结果转为记录不低于该值的骰子个数 | - | 参数

通俗来讲，存在以下几种常见用法：  
`AdB`是最基本的扔`A`个`B`面骰
其中`A`和`B`缺省时将会从人物卡模板中读取默认值  
例如COC下`AdB`默认为`1d100`  

> .r d  
> 骰子: [仑质]掷骰: d=79  
>
> .r 5d  
> 骰子: [仑质]掷骰: 5d={89+76+9+24+39}(237)=237  
>
> .r d50  
> 骰子: [仑质]掷骰: d50=23  
> 
> .r 5d12 骰5个12面骰  
> 骰子: [仑质]由于[骰5个12面骰]掷骰: 5d12={6+12+10+12+4}(44)=44  

`AdBkC`和`AdBqC`是最基本的扔`A`个`B`面骰的基础上  
取最大(k)或最小(q)的几个骰点相加  

> .r 4d6k3 骰4个6面骰，选3个最大的  
> 骰子: [仑质]由于[骰4个6面骰，选3个最大的]掷骰: 4d6k3={6,4,4,2}\[6+4+4\](14)=14  

`AdBbC`和`AdBpC`则是和`奖励骰/惩罚骰 b/p`类似的掷骰方式  
但是区别在于，这可以一次掷出多个骰子，并分别骰相同个数的奖惩骰  
由于这种骰子本质上是基于`d100`的，所以  
在这种情况下`B`会被忽略并锁定为`100`  

> .r 2db3  
> 骰子: [仑质]掷骰: 2db3={  
>     {1D100=71 bonus:[4,3,[2]]}(21),  
>     {1D100=85 bonus:[[4],[4],7]}(45)  
> }\[21+45\](66)=66  
> 
> .r 3d100p2  
> 骰子: [仑质]掷骰: 3d100p2={  
>     {1D100=81 punish:[[2],[2]]}(81),  
>     {1D100=61 punish:[2,[3]]}(61),  
>     {1D100=79 punish:[[5],2]}(79)  
> }\[81+61+79\](221)=221  

`AdBaC`则彻底改变了`d`的意义和结算方式，使得这个骰子变成了骰池  
结算方式也由原先的点数相加变成了计算不低于`C`的骰子的个数  
这等同`无限加骰池 a`的`Aa(B+1)kCmB`  

> .r 4d6a3 骰4个6面骰，成功线为3  
> 骰子: [仑质]由于[骰4个6面骰，成功线为3]掷骰: 4d6a3={[5],[6],1,[5]}(3)=3  
>
> .r 4a(6+1)k3m6  
> 骰子: [仑质]由于[骰4个6面骰，成功线为3]掷骰: 4a(6+1)k3m6={[5],[6],1,[5]}(3)=3  

#### 奖励骰/惩罚骰 b/p
```
A(pb)B
```
先来看看`OneDice`怎么说：  
> 这是来自COC的掷骰方式，即为掷`1`个面数为`100`的多面骰子(实质上为：范围`0~9`的`10`面个位骰；范围`0~9`的`10`面十位骰，其中当出值为`0`时记作`100`)，再掷`B`个面数为`10`的`惩罚骰/奖励骰`，用其中`最大/最小`点数替换原先的十位骰，然后计算它们（全部或部分）的点数总和，即为该表达式的最终结果。  

 符号 | 参数 | 名称 | 解释 | 缺省 | 类别
 :---: | :---: | :--- | :--- | :--- | :---
 p/b | A | - | 无意义 | 1 | 左值
 p/b | B | 面数 | 追加奖惩骰的个数 | 1 | 右值

通俗来讲，也就是说这是一类特殊的骰子，线下游戏时，D100是两个10面骰骰出来的，一个是个位，一个是十位。  
如果两个10面骰都骰到0，那结果就是100  
奖惩骰的机制是，多指定数量个十位骰，例如获得2个奖励骰，那么就丢3个十位骰。  
假设十位骰结果是{4,5,8}，个位骰结果是2，那么最终结果就是42（取好的结果）  
如果是惩罚骰，那么最终结果是82（取坏的结果）  

> .r b
> 骰子: [仑质]掷骰: b={1D100=90 bonus:[8]}(90)=90
> 
> .rb3
> 骰子: [仑质]掷骰: b3={1D100=63 bonus:[[1],2,4]}(13)=13
> 
> .r p4 惩罚骰
> 骰子: [仑质]由于[惩罚骰]掷骰: p4={1D100=96 punish:[3,7,7,[8]]}(96)=96

特别的，可以与`d`结合使用  
`AdBbC`和`AdBpC`可以一次掷出多个骰子，并分别骰相同个数的奖惩骰  

> .r 2db3  
> 骰子: [仑质]掷骰: 2db3={  
>     {1D100=71 bonus:[4,3,[2]]}(21),  
>     {1D100=85 bonus:[[4],[4],7]}(45)  
> }\[21+45\](66)=66  
> 
> .r 3d100p2  
> 骰子: [仑质]掷骰: 3d100p2={  
>     {1D100=81 punish:[[2],[2]]}(81),  
>     {1D100=61 punish:[2,[3]]}(61),  
>     {1D100=79 punish:[[5],2]}(79)  
> }\[81+61+79\](221)=221  

#### WOD/无限加骰池 a
```
AaBkCqDmE
```
先来看看`OneDice`怎么说：  
> 这是常见于无限规则的掷骰方式，即为掷`A`个面数为`E`的多面骰子，计算点数不低于`B`的骰子个数，然后以此为新的骰子个数进行下一轮掷骰，直到下一轮掷骰不存在，然后求出所有累计结果中点数不低于`C`(如果有)以及不高于`D`(如果有)的骰子个数，即为该表达式的最终结果。  

 符号 | 参数 | 名称 | 解释 | 缺省 | 类别
 :---: | :---: | :--- | :--- | :--- | :---
 a | A | 初始骰数 | 第一轮掷出多少个骰子 | - | 左值
 a | B | 加骰线 | 每有一枚不低于该值</br>则下一轮掷骰增加一枚骰子 | - | 右值
 k | C | 成功线 | 最终计算不低于该参数的骰子个数 | 8 | 参数
 q | D | 反向成功线 | 最终计算不高于该参数的骰子个数 | - | 参数
 m | E | 面数 | 掷出的骰子有多少面 | 10 | 参数

通俗来讲，这是WOD(狂野世界)骰点规则，国内更多见于无限团，默认使用d10。  
这个规则需要设定几个参数：骰池数量`A`、加骰线`B`、成功线`C`，其中`A``B`是必须的，成功线默认为`8`  
这是一个多轮骰点规则，骰`A`个d10，每有一个≥成功线的骰，成功数+1，每有一个≥加骰线的骰，加骰数+1，随后下一轮骰点使用上一轮的加骰数作为骰池数量，如此往复直到加骰数为零则自然停止。  

> .r 10a6k4m9
> 骰子: [仑质]掷骰: 10a6k4m9={  
>     {[4],<[9]>,<[9]>,<[7]>,<[6]>,3,<[6]>,[4],1,3},  
>     {[5],<[7]>,<[8]>,[5],3},  
>     {<[6]>,1},{3}  
> }\[7+4+1+0\](12)=12  

同时，额外支持`q`参数(与`k`参数相对)，可使用`q5`参数计算`≤5`的骰数  
*这曾是OneDice标准在2021年9月起草时的废案*  

> .r 10a6k8q4m9  
> 骰子: [仑质]掷骰: 10a6k8q4m9={  
>     {<[9]>,<6>,[2],5,<[9]>,5,[4],5,[2],[4]},  
>     {[1],<7>,[2]},{[3]}  
> }\[6+2+1\](9)=9  

特别的，有些规则的人物卡模板中`k`的参数`C`不存在默认值，这时将不会强制计算`k`的效果  


#### 双重十字骰池 c
```
AcBmC
```
先来看看`OneDice`怎么说：  
> 这是常见于双重十字规则的掷骰方式，即为掷`A`个面数为`C`的多面骰子，计算点数不低于`B`的骰子个数，然后以此为新的骰子个数进行下一轮掷骰，直到下一轮掷骰不存在，最后一轮记其最大值，此前每一轮记为`C`点，然后累加每一轮的点数总和。  

 符号 | 参数 | 名称 | 解释 | 缺省 | 类别
 :---: | :---: | :--- | :--- | :--- | :---
 c | A | 初始骰数 | 第一轮掷出多少个骰子 | - | 左值
 c | B | 加骰线 | 每有一枚不低于该值</br>则下一轮掷骰增加一枚骰子 | - | 右值
 m | C | 面数 | 掷出的骰子有多少面 | 10 | 参数

通俗来讲，这是一种多轮的骰点规则。一般为骰若干个`d10`，并指定暴击值。  
如果达到暴击值，则进入下一轮，直到全部骰子都不能暴击。  
若为暴击，则本轮记为骰子最大点数`B`，例如`d10`为`10`、`d7`为`7`
最终的骰点结果为: 暴击轮数 * `B` + 最后一轮中最大的点数  

> .r 4c3m7  
> 骰子: [仑质]掷骰: 4c3m7={  
>     {<5>,2,2,<7>},  
>     {<3>,2},{<4>},  
>     {[2]}  
> }\[7*3+2\](23)=23  
> 
> .r 4c3  
> 骰子: [仑质]掷骰: 4c3={  
>     {2,<8>,<10>,<4>},  
>     {2,<3>,<7>},  
>     {<8>,1},  
>     {<8>},  
>     {<4>},  
>     {[2]}  
> }\[10*5+2\](52)=52  

骰4个d7，暴击值为3。若不设置m则为4个`d10`  

#### FATE掷骰池/命运骰 f
```
AfB
```
理论上，`FATE`规则发展自`Fudge`规则。
也有一种说法是`f`来自`摇摆骰`的英文`flap dice`  

先来看看`OneDice`怎么说：  
> 这是常见于FATE规则的掷骰方式，即为掷`A`个面数为`3`的多面骰子，该骰子的三面分别为`+`/`-`/`0`，分别计为`1`、`-1`、`0`，计算所有骰子点数总和，即为该表达式的最终结果。  

 符号 | 参数 | 名称 | 解释 | 缺省 | 类别
 :---: | :---: | :--- | :--- | :--- | :---
 f | A | 骰数 | 掷出多少个骰子 | 4 | 左值
 f | B | - | 无意义 | 3 | 右值

当然，在现实中，这实际上是一种特殊的六面骰，六个面分别为 - - 0 0 + +，分别代表 -1 0 1  
骰点时投掷4次，加在一起为结果。例如某次结果是[-+++]，为 -1 + 1 + 1 + 1 = 2  

> .r f  
> 骰子: [仑质]掷骰: f={+ - 0 +}\[1-1+0+1\](1)=1  
>
> 带补正的情况:  
> .r f+1  
> 骰子: [仑质]掷骰: f+1={+ 0 - 0}\[1+0-1+0\](0)+1=1  
>
> .r 5f+2  
> 骰子: [仑质]掷骰: 5f+2={- + 0 + +}\[-1+1+0+1+1\](2)+2=4  
>
> .r 5df+3  
> 骰子: [仑质]掷骰: 5df+2={- + 0 + -}\[-1+1+0+1-1\](0)+3=3  

#### 多元组使用
多元组的格式是被`[`和`]`包裹的，被一系列`,`分隔的表达式，这种表达式可以实现表达式的嵌套与多条表达式的组合，并且可以配合`kh`、`kl`或`lp`来实现特殊的操作。  

> .r [4d6k3,4d6k3,4d6k3,4d6k3,4d6k3,4d6k3]  #DND5E人物卡作成  
> 骰子: [仑质]掷骰: [4d6k3,4d6k3,4d6k3,4d6k3,4d6k3,4d6k3]=12, 17, 10, 15, 18, 12  

#### 优势劣势/最大最小
这种算符需要与`d`、`f`、`多元组`配合使用。  
`kh`将会返回其左侧多个结果中的最大值，而`kl`将会返回其左侧多个结果中的最小值  

> .r 6dkh  
> 骰子: [仑质]掷骰: 6dkh={19, 26, 41, 49, 33, 65}(65)=65  
>
> .r 5d12kh  
> 骰子: [仑质]掷骰: 6d12kh={1, 10, 8, 1, 5}(10)=10  
>
> .r 4dkl  
> 骰子: [仑质]掷骰: 4dkl={87, 7, 71, 83}(7)=7  
>
> .r 7fkl  
> 骰子: [仑质]掷骰: 7fkl={0, 1, 0, -1, 0, 1, 0}(-1)=-1  
>
> .r [2d6,10]kh  
> [仑质]掷骰: [2d6,10]kh={2d6 = 5, 10}(10)=10  
>
> .r [2d12+3,10d6\*2]kl  
> [仑质]掷骰: [2d12+3,10d6\*2]kh={2d12+3 = 25, 10d6\*2 = 56}(56)=25  
>
> .r (2d12+3)kh  
> [不妙]掷骰: \(2d12\+3\)kh={6, 8}\(8\)=8  

#### 循环
`lp`算符支持快速使用循环，其左侧的值与循环次数与变量相关，右侧则是被作为循环体的多元组，它支持以下几种格式：  

> .r 7lp[i]  #表示从1~7，每次循环增长1  
> 骰子: [仑质]掷骰: 7lp[i]={1:1:7}lp{i}=1, 2, 3, 4, 5, 6, 7  
>
> .r 6lp[4d6k3]  #更简短的 DND5E 人物作成  
> 骰子: [仑质]掷骰: 6lp[4d6k3]={1:1:6}lp{4d6k3}=8, 11, 16, 14, 15, 9  
>
> .r 6lp[id6]  #配合循环变量进行使用  
> 骰子: [仑质]掷骰: 6lp[id6]={1:1:6}lp{id6}=1, 5, 11, 20, 21, 12  
>
> .r [2,6]lp[i]  #表示从2~6，每次循环增长1  
> 骰子: [仑质]掷骰: [2,6]lp[i]={2:1:6}lp{i}=2, 3, 4, 5, 6  
>
> .r [3,3,12]lp[i]  #表示从2~6，每次循环增长3  
> [仑质]掷骰: [3,3,12]lp[i]={3:3:12}lp{i}=3, 6, 9, 12  
>
> .r [3,3,12]lp[i]kh  #与优势配合  
> [仑质]掷骰: [3,3,12]lp[i]kh={3, 6, 9, 12}(12)=12  

#### 临时变量
`$t标号=数字`格式可以完成赋值  
`$t标号`格式则可以完成对已经记录的变量的调用  

> .r \[$t1=1,$t2=2,$t1+$t2\]  
> 骰子: \[仑质\]掷骰: \[$t1=1,$t2=2,$t1+$t2\]=1, 2, 3  
>
> .r 6lp\[$t1=($t1+i)\]  #配合循环的使用  
> 骰子: \[仑质\]掷骰: 6lp\[$t1=($t1+i)\]={1:1:6}lp{$t1=($t1+i)}=1, 3, 6, 10, 15, 21  
>
> \#配合人物卡的使用
> .st 驾驶30  
> 骰子: \[仑质\]的人物卡已保存  
>
> .r \[$t1=驾驶,驾驶d6\]  
> 骰子: \[仑质\]掷骰: [$t1={驾驶},{驾驶}d6\]=30, 103  

#### DND5E优势骰劣势骰
> .st temp dnd5e  
> 骰子: 人物卡[仑质]套用模板[dnd5e]  
> 
> .r 2dkh 优势  
> 骰子: [仑质]由于[优势]掷骰: 2dk1={11,1}\[11\](11)=11  
>
> .r 2d20kl 劣势  
> 骰子: [仑质]由于[劣势]掷骰: 2dk1={11,1}\[11\](11)=11  

优势 `2dkh`，`dnd5e`下默认`d`为`d20`，即`2`个`d20`取结果高的一个  
劣势 `2d20kl`，即`2`个`d20`取结果低的一个  

#### fvtt骰点
> .r 2d20kh  // 优势骰  
> 骰子: [仑质]掷骰: 2d20k1={17,15}\[17\](17)=17  
>   
> .r 2d20kl  // 劣势骰  
> 骰子: [仑质]掷骰: 2d20q1={11,15}\[11\](11)=11  
>   
> .r 4d6k3 // 丢4排除1个最低值  
> 骰子: [仑质]掷骰: 4d6k3={6,6,4,3}\[6+6+4\](16)=16  
>   
> .r 4d6q3 // 丢4排除1个最高值  
> 骰子: [仑质]掷骰: 4d6q3={2,3,3,5}\[2+3+3\](8)=8  
>   
> .r [2d6,10]kh // 丢2d6切至少不低于10  
> 骰子: [仑质]掷骰: \[2d6,10\]kh={2d6 = 6, 10}\(10\)=10  
> 骰子: [仑质]掷骰: \[2d6,10\]kh={2d6 = 11, 10}\(10\)=11  

#### 混合运算
> .r 30+(-1d20)+49  
> 骰子: [仑质]掷骰: 30+(-1d20)+49=30+0-{10}(10)+49=69  
>   
> .r d50\*3+2  
> 骰子: [仑质]掷骰: d50\*3+2={9}(9)\*3+2=29  
>   
> .r d50\*3+(2-p2) 多项式  
> 骰子: [仑质]由于[多项式]掷骰: d50*3+(2-p2)={31}(31)*3+2-{1D100=21 punish:[[8],2]}(81)=14  

事实上，初等运算在OneDice是完全支持的：  
初等运算算符: 加减乘除(`+-*/`)、乘方(`^`)、括号  
骰子算符: `d`、`a`、`c`、`f`  
符合直觉的是，它们和加减乘除是一样的：  
> .r 1d1d1d1d1d1d1d1d1d1d1d1d1d1d(20+1d3\*4)  
> 骰子: [仑质]掷骰: 1d1d1d1d1d1d1d1d1d1d1d1d1d1d(20+1d3\*4)=13  
>
> .r dddd  //相当于是 ((((1d100)d100)d100)d100)  
> 骰子: [仑质]掷骰: dddd=3849  
>
> .r (7a3)d(5d(2^2)k3+5f)+d  
> 骰子: [仑质]掷骰: (7a3)d(5d(2^2)k3+5f)+d={3+4+5+4}(16)+{4}(4)=20  
>
> .r 1d10+(1+32)d(4\*6)d20  
> 骰子: [仑质]掷骰: 1d10+(1+32)d(4\*6)d20=4162  

#### 多轮骰点
任何表达式都支持多轮掷骰  
> .r 4#d10+6d2  
> 骰子: [仑质]掷骰: d10+6d2=10, 20, 13, 12  
>
> .r 5#(7a3)d(5d(2^2)k3+5f)+d  
> 骰子: [仑质]掷骰: (7a3)d(5d(2^2)k3+5f)+d=129, 71, 97, 117, 69  

## 设置主骰
这个指令可以修改`.r`指令的默认表达式
`.set [面数]` 设置主骰为对应面数骰子  
`.set [表达式]` 设置主骰为对应表达式的骰子  

> .set 20  
>   
> 骰子:  
> 已设置本群套用主骰\[1D20\]  
>   
> .r  
>   
> 骰子:  
> \[仑质\]掷骰: 1D20=11  
>   
> .set 4d40  
>   
> 骰子:  
> 已设置本群套用主骰\[4D40\]  
>   
> .r  
>   
> 骰子:  
> \[仑质\]掷骰: 4D40=\{30\+30\+23\+7\}\(90\)=90  
>   
> .rd  
>   
> 骰子:  
> \[仑质\]掷骰: 1D40=25  
>   
> .set   
>   
> 骰子:  
> 已设置本群套用主骰\[7A5\]  
>   
> .r  
>   
> 骰子:  
> \[仑质\]掷骰: 7A5=\{  
> \{<\[8\]\>, 1, 4, 3, 2, 4, <\[9\]\>\},  
> \{3, <7\>\},  
> \{4\}  
> \}\[2\+0\+0\]\(2\)=2  

## 人物卡
本核心的人物卡提供了兼容多种其他核心的录入格式，并提供多人物卡，人物卡模板等，使其能够灵活的切换规则书与规则的细节。  

### 重命名
`.nn [人物卡名]` 重命名人物卡  

### 录入/批量录入
`.st [人物卡名]-[技能名][技能值][技能名][技能值]……` 以该人物卡名建卡并批量录入  
`.st [技能名][技能值][技能名][技能值]……` 人物卡批量录入  
`.st &[武器名]=[表达式]` 人物卡自定义武器录入  
`.st rm [技能名]` 删除对应技能
`.st rm [技能名1][技能名2]...` 删除多个技能
`.st blockrm (技能块)` 删除人物卡里对应的技能块

### 显示人物卡
`.st show` 显示人物卡  
`.st [技能名]` 显示人物卡单个技能  
`.st [技能名1][技能名2]...` 显示人物卡多个技能  
`.st show [技能名]` 显示人物卡单个技能  
`.st show [技能名1][技能名2]...` 显示人物卡多个技能

### 技能快速操作
`.st [技能名][技能值]` 单个技能修改  
`.st [技能名](+-*/)[掷骰表达式或数值]` 单个技能修改  
`.st [技能名1](+-*/=)[掷骰表达式或数值][技能名2](+-*/=)[掷骰表达式或数值]...` 多个技能修改

### 多人物卡
`.st list` 显示人物卡列表
`.st new [人物卡名]` 新建人物卡
`.st set [人物卡名]` 切换人物卡
`.st del [人物卡名]` 删除人物卡，默认删除当前人物卡
`.st clear` 清空当前人物卡
`.st lock` 锁定人物卡
`.st unlock` 解锁人物卡

### 人物卡导出
`.st export (人物卡)` 导出人物卡的技能为导入格式，默认导出当前人物卡

### 人物卡模板/规则
`.st temp [人物卡模版名]` 切换人物卡模版

默认可选：`COC7`，`DND5E`，`FATE`

`.st rule [人物卡模版规则名]` 切换人物卡规则  

### 人物卡作成
`.st init (force)` 人物卡作成  

将依照当前人物卡进行作成，作成前请先行切换人物卡  

### 人物卡记录
`.st note [记录名] [内容]`    添加人物卡记录
`.st note rm [记录名] [内容]`    删除人物卡记录

### 人物卡映射/自定义武器
`.st rec [映射名] [表达式]`    添加人物卡映射
`.st rec rm [映射名] [表达式]`    删除人物卡映射

特别需要注意的是，人物卡映射也可以通过`st &技能名=表达式`的格式录入  
同时，`ri`、`init set`、`sn`等指令也会在特定情况下修改特定的映射  

> .st &巨斧=2d12  
> 骰子: [仑质]的人物卡已保存  
>   
> .st show  
>   
> 骰子:  
> 人物卡[仑质]:  
> <映射>  
> 巨斧:2d12  

## 检定
`.ra [技能名] [技能值]` 技能检定  
`.rah [技能名] [技能值]` 暗技能检定  
`.ra[次数]#[技能名] [技能值]` 多轮检定  
`.ra(b/p)[技能名] [技能值]` 奖惩检定  
`.ra [技能名](+-*/)[调整值] [技能值]` 附带快速调整的技能检定  

## 对抗检定
`.rav [技能名1] (数值1) (技能名2) (数值2) [@对方]` 与指定用户进行对抗检定

技能名1为自己使用的技能，技能名2为对方使用的技能
技能名2可忽略，若忽略则双方都用技能名1进行检定
数值1，数值2均可忽略，若忽略技能数值从人物卡中读取
技能名和数值之间必须有空格

## 理智检定
`.sc [成功表达式]/[失败表达式] [san值]` 理智检定
`.sc(b/p) [成功表达式]/[失败表达式] [san值]` 奖惩理智检定

## 成长检定
`.en [技能名] [技能值]` 成长检定
`.en [技能名1][技能名2]...` 多项技能成长检定

省略技能值时将从人物卡中读取技能值  
省略技能名等时，将依据检定历史进行自动成长检定  

## 跑团名片
`.sn`  套用人物卡/人物卡模板中的名片记录  
`.sn coc`  套用coc跑团名片  
`.sn dnd`  套用dnd跑团名片  
`.sn [自定义名片]`  套用任意自定义名片  
`.sn auto`  切换自动群名片功能
`.sn auto on`  开启自动群名片功能
`.sn auto off`  关闭自动群名片功能

## 先攻
`.ri [表达式] [名称]`  添加先攻  
`.ri [表达式] [名称],[表达式] [名称],[表达式] [名称]`  添加多条先攻  

表达式有如下格式:  
`.ri +6`  表示 1D20+6  
`.ri =1D20+4`  表示 1D20+4  
`.ri 4`  表示 4  

> .ri +3 哥布林1,=4d6 哥布林2,12  
>   
> 骰子:  
> 先攻列表已设置:  
> 1\. \[哥布林1\]: 1D20+3=8  
> 2\. \[哥布林2\]: 4d6=16  
> 3\. \[仑质\]: 12=12  
>   
> .ri +6  
>   
> 骰子:  
> 先攻列表已设置:  
> 1\. \[仑质\]: 1D20+6=13  

`.init`  显示先攻列表  
`.init set [表达式] [名称]`  添加先攻  
`.init set [表达式] [名称],[表达式] [名称],[表达式] [名称]`  添加多条先攻  
`.init del [名称]`  删除先攻  
`.init clear`  清空先攻列表  
`.init reset`  重新生成先攻列表  

> .init set +3 哥布林1,=4d6 哥布林2,12  
>   
> 骰子:  
> 先攻列表已设置:  
> 1\. \[哥布林1\]: 1D20+3=8  
> 2\. \[哥布林2\]: 4d6=16  
> 3\. \[仑质\]: 12=12  
>   
> .init  
>   
> 骰子:  
> 当前先攻列表:  
> 1\. \[哥布林2\]: 16  
> 2\. \[仑质\]: 12  
> 3\. \[哥布林1\]: 8  
>   
> .init reset  
>   
> 骰子:  
> 重新生成先攻列表:  
> 1\. \[哥布林1\]: 1D20+3=23  
> 2\. \[不妙\]: 12=12  
> 3\. \[哥布林2\]: 4d6=9  

## 房规
`.setdnd` 为当前群或频道组设置DND5E房规  
`.setcoc [参数]` 为当前群或频道组设置COC房规  

如`[.setcoc 1]`, 当前参数`0-7`，为空时将清除设置  

| 编号 | 规则 | 解释 |
|:-:|:-:|:--|
| 0 | C0 | 出1大成功<br/>不满50出96 - 100大失败，满50出100大失败 |
| 1 | C1 | 不满50出1大成功，满50出1 - 5大成功<br/>不满50出96 - 100大失败，满50出100大失败 |
| 2 | C2 | 出1 - 5且 <= 成功率大成功<br/>出100或出96 - 99且 > 成功率大失败 |
| 3 | C3 | 出1 - 5大成功<br/>出96 - 100大失败 |
| 4 | C4 | 出1 - 5且 <= 十分之一大成功<br/>不满50出 >= 96 + 十分之一大失败，满50出100大失败 |
| 5 | C5 | 出1 - 2且 < 五分之一大成功<br/>不满50出96 - 100大失败，满50出99 - 100大失败 |
| 6 | C6 | 出1 - 3大成功<br/>出98 - 100大失败 |
| 7 | DeltaGreen<br/>绿色三角洲 | 小于等于检定目标成功，若结果为1或两骰相同为大成功（相当于整除11）<br/>大于检定目标失败，若结果为100或两骰相同为大失败（相当于整除11）<br/>没有极难成功/困难成功 |

如果其他房规可向开发者反馈，或是使用人物卡模板扩展系统  
群内检定会优先调用群内设置  

## 人物作成
`.coc [数量]` COC7人物作成  
`.dnd [数量]` DND5E人物作成  
推荐使用`[.st init]`指令进行人物卡作成  

## 疯狂症状
`.ti` 临时疯狂症状  
`.li` 总结疯狂症状  

## 抽牌堆
`.draw [牌堆名称]` 抽牌堆  
`.drawh [牌堆名称]` 暗抽牌堆  

## 随机姓名
`.name (cn/jp/en/enzh)`  
后接cn/jp/en/enzh则限定生成中文/日文/英文/英文中译名  

## 旁观
`.ob` 切换旁观模式  
`.ob join` 加入旁观模式  
`.ob exit` 退出旁观模式  
`.ob exit all` 退出所有已旁观  
`.ob clear` 清空本群旁观列表  

## 规则查询
查询规则相关内容  
`.rule  [查询内容]`  
`.rules [查询内容]`  

## 日志功能
`.log on (名字)` 开始记录日志
`.log off (名字)` 暂停记录指定日志或当前日志
`.log end (名字)` 完成记录并发送日志文件  
`.log temp (名字)` 临时上传指定的日志
临时上传日志不影响记录，若不指定名字则默认为活跃日志
`.log stop (名字)` 强制停止日志不上传
`.log set [名字]` 切换活跃日志
`.log rename [新名字](/旧名字)` 重命名活跃日志或指定日志
`.log list` 查看本群日志列表
`.log upload [UUID]` 手动上传指定UUID的日志
指定UUID的日志必须为已经end/stop的日志

日志的默认名称为 default
日志上传存在失败可能，届时请联系后台管理索取  

## 群内服务

### 入群欢迎词
`.welcome [欢迎词]` 设置欢迎词  
`.welcome` 删除欢迎词  

## 故事引擎/单人跑团

### 故事引擎
`.story [故事名称]` 开始一个新故事故事  
`.story end` 结束这个故事  

当你没有输入一个正确的故事名称时，将会为你模糊匹配并列出相近的故事名称。  

## 娱乐功能

### 今日人品
`.jrrp` 今日人品  
`.zrrp` 昨日人品  
`.mrrp` 明日人品  

此功能采用源自《梅花易数》的卜算方法，以日期与八字起卦进行推演，结果仅供参考。  

### 戳一戳
在手机QQ中戳一戳可以调整为掷骰，具体要看骰主的设置，未设置时将会回复版本号。  

## 联动功能

### 魔都模组
`.cnmods roll` 在线抽取一个模组  
`.cnmods luck ([页码])` 查看魔都推荐  
`.cnmods search [名称] ([页码])` 在线查找模组  
`.cnmods get [编号]` 获取对应模组  

本模块所实现功能已获[魔都模组](https://www.cnmods.net)官方授权，特此感谢  
